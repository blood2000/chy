<template>
	<el-dialog :title="title" :visible="visible" width="500px" append-to-body @close="cancel">
		<el-form ref="form" :model="form" :rules="rules" label-width="80px">
			<el-form-item label="运输单号" prop="waybillNo">
				<el-input v-model="form.waybillNo" />
			</el-form-item>
			<el-form-item label="异常原因" prop="abnormalReason">
				<el-input v-model="form.abnormalReason" type="textarea" placeholder="请输入异常原因" />
			</el-form-item>
		</el-form>
		<div slot="footer" class="dialog-footer">
			<el-button type="primary" @click="submitForm">确 定</el-button>
			<el-button @click="cancel">取 消</el-button>
		</div>
	</el-dialog>
</template>

<script>
import { getDetail } from "@/api/waybill/manages";
export default {
	props: {
    title: String,
    open: Boolean,
		currentId: Number
  },
	data() {
		return {
			// 表单参数
      form: {},
      // 表单校验
      rules: {}
		}
	},
	computed: {
    visible: {
      get() {
        return this.open;
      },
      set(v) {
        this.$emit("update:open", v);
      },
    },
  },
	watch: {
		open(val) {
			if(val) {
				this.reset();
				this.getDetail();
			}
		}
	},
	create() {

	},
	methods: {
		// 获取详情
		getDetail() {
			getDetail(this.currentId).then(response => {
				this.form = response.data;
			});
		},
		// 提交按钮
    submitForm: function() {
      this.$refs["form"].validate(valid => {
        if (valid) {
					this.msgSuccess("修改成功");
					this.close();
					this.$emit('refresh');
        }
      });
    },
		// 取消按钮
    cancel() {
      this.close();
      this.reset();
    },
		// 关闭弹窗
    close() {
      this.$emit("update:open", false);
    },
		// 表单重置
    reset() {
      this.form = {
				waybillNo: null,
				abnormalReason: null
      };
      this.resetForm("form");
    },
	}
}
</script>